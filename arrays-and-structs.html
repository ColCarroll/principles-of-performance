

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Arrays and Structs &mdash; principles-of-performance  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Memory Locality" href="memory-locality.html" />
    <link rel="prev" title="Low Level Computation" href="low-level-computation.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> principles-of-performance
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bits.html">Bits</a></li>
<li class="toctree-l1"><a class="reference internal" href="low-level-computation.html">Low Level Computation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Arrays and Structs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#arrays">Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#multi-byte-values-in-arrays">Multi-Byte Values in Arrays</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#structs">Structs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multi-dimensional-arrays">Multi-Dimensional Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#row-order">Row Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="#column-order">Column Order</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="memory-locality.html">Memory Locality</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory-management.html">Memory Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-to-optimize-code.html">How to Optimize Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="python-overview.html">Python Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy-overview.html">Numpy Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">principles-of-performance</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Arrays and Structs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/arrays-and-structs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="arrays-and-structs">
<h1>Arrays and Structs<a class="headerlink" href="#arrays-and-structs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="arrays">
<h2>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">¶</a></h2>
<p>In most real world programs, we are less interested in storing a single number
at a time and more interested in storing a sequence of numbers. The easiest way
to store more than one number is to just stick them next to each other in
<a class="reference internal" href="appendix.html#main-memory"><span class="std std-ref">memory</span></a>. A region of memory which holds a sequence of values
of the same type is called an <a class="reference internal" href="appendix.html#array"><span class="std std-ref">“array”</span></a>. In memory, the array of 1
byte integers <code class="docutils literal notranslate"><span class="pre">[108,</span> <span class="pre">109,</span> <span class="pre">97,</span> <span class="pre">111]</span></code> would look like:</p>
<img alt="_images/1-byte-value-array.png" src="_images/1-byte-value-array.png" />
<p>In order to access the elements of the array, we would just add the offset to
the base address of the array. This is where the 0-indexed convention for lists
comes from, the first element is 0 elements away from the start.</p>
<p>The advantage of packing the elements next to each other in this way is that we
can now refer to the entire sequence with just a <a class="reference internal" href="appendix.html#pointer"><span class="std std-ref">pointer</span></a> to the
first element. This means that we can semantically move a lot of data just by
moving a single integer.</p>
<div class="section" id="multi-byte-values-in-arrays">
<h3>Multi-Byte Values in Arrays<a class="headerlink" href="#multi-byte-values-in-arrays" title="Permalink to this headline">¶</a></h3>
<p>Arrays may contain multi-byte values. Just like arrays of single-byte values,
the elements are laid out next to each other in memory.</p>
<img alt="_images/multi-byte-value-array.png" src="_images/multi-byte-value-array.png" />
<p>In order to access element <span class="math notranslate nohighlight">\(n\)</span> of an array at address <span class="math notranslate nohighlight">\(p\)</span> with
elements of size <span class="math notranslate nohighlight">\(s\)</span> we just read the value at the address: <span class="math notranslate nohighlight">\(p +
sn\)</span>.</p>
</div>
</div>
<div class="section" id="structs">
<h2>Structs<a class="headerlink" href="#structs" title="Permalink to this headline">¶</a></h2>
<p>Another common low-level data structure is called a <a class="reference internal" href="appendix.html#struct"><span class="std std-ref">“struct”</span></a>,
short for “structure”. Structures are a fixed length, ordered collection of
potentially different types of values. A structure works similar to an array,
where we just pack the values next to each other in memory. Structures are
useful because, just like with <a class="reference internal" href="appendix.html#array"><span class="std std-ref">arrays</span></a>, they allow us to
semantically move many related values with a single <a class="reference internal" href="appendix.html#pointer"><span class="std std-ref">pointer</span></a>.</p>
<p>Imagine we want to represent a structure with the following fields:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">int32</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">int8</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">int16</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The memory for a single instance of this struct may look like:</p>
<img alt="_images/struct.png" src="_images/struct.png" />
<p>Just like we can compute the address of any given element in an array from the
address of the first value and the index, we can compute the address of any
member of the structure from just the first value. Instead of accounting for an
index, we just need to know through some side-channel method what the expected
offset is. The idea is that if we lay out the data at a particular offset from
the first element when we write it, then code that requires just the <code class="docutils literal notranslate"><span class="pre">c</span></code> field
can be hard coded to read <span class="math notranslate nohighlight">\(p + 6\)</span> and the value will be there. There is
nothing that enforces that this is true, it is just a convention for arranging
memory.</p>
<p>The reason that the 6th byte is unused is that we may want to keep all of our
<code class="docutils literal notranslate"><span class="pre">int16</span></code> (2 byte integer) values at an address that is a multiple of 2. Some
hardware operations are faster when reading values that are “aligned” to a
multiple of their size. We will discuss this more later.</p>
</div>
<div class="section" id="multi-dimensional-arrays">
<h2>Multi-Dimensional Arrays<a class="headerlink" href="#multi-dimensional-arrays" title="Permalink to this headline">¶</a></h2>
<p>Memory is intrinsically one dimensional because the machine natively addresses
memory with a scalar integer. Therefore, in order to store a semantically
multi-dimensional array we need to store some flattening of the data and design
a mapping from coordinate to a single address. The general way to do this is to
think of a multi-dimensional array as an “array of arrays”, or an array whose
elements are themselves arrays. An array just stores its values one after the
other in memory, so a multi-dimensional array can be stored by laying out a
sequence of arrays of progressively smaller dimensionality.</p>
<p>For example, let’s consider a 2d array of shape <code class="docutils literal notranslate"><span class="pre">(6,</span> <span class="pre">3)</span></code>, or 6 rows by 3
columns:</p>
<img alt="_images/2d-array.png" src="_images/2d-array.png" />
<p>There are two ways we can define this as an “array of arrays”:</p>
<ul class="simple">
<li>a length 6 array of length 3 arrays, a collection of rows</li>
<li>a length 3 array of length 6 arrays, a collection of columns</li>
</ul>
<div class="section" id="row-order">
<h3>Row Order<a class="headerlink" href="#row-order" title="Permalink to this headline">¶</a></h3>
<p>Row order is where the array is arranged in memory as a collection of rows. This
is also called “C order” because the C programming language often uses arrays
arranged this way.</p>
<img alt="_images/row-order.png" src="_images/row-order.png" />
<p>The formula to get element <span class="math notranslate nohighlight">\((r, c)\)</span> is:</p>
<div class="math notranslate nohighlight">
\[getitem(r, c) = r * Num Columns + c\]</div>
</div>
<div class="section" id="column-order">
<h3>Column Order<a class="headerlink" href="#column-order" title="Permalink to this headline">¶</a></h3>
<p>Column order is where the array is arranged in memory as a collection of
columns. This is also called “F order” or “Fortran” order because the Fortran
programming language often used arrays arranged in this way.</p>
<img alt="_images/column-order.png" src="_images/column-order.png" />
<p>The formula to get element <span class="math notranslate nohighlight">\((r, c)\)</span> is:</p>
<div class="math notranslate nohighlight">
\[getitem(r, c) = c * Num Rows + r\]</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful not to confuse “C order” with column order, they are opposites!</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="memory-locality.html" class="btn btn-neutral float-right" title="Memory Locality" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="low-level-computation.html" class="btn btn-neutral" title="Low Level Computation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Joe Jevnik

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>